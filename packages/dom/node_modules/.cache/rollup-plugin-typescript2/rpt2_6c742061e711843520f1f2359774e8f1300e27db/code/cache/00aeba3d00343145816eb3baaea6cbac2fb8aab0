{"code":"import { notNullOrUndefined } from \"shared\";\r\nexport class GlobalEventCoordinator {\r\n    eventTargets = new Map();\r\n    targetHandlers = new WeakMap();\r\n    // registers a delegated event handler on the target. Bubbling is\r\n    // simulated, with support for events dispatched by nodes within a shadow\r\n    // dom.\r\n    attachEventHandler(event, target, handler) {\r\n        if (!this.eventTargets.has(event)) {\r\n            this.eventTargets.set(event, new WeakSet());\r\n            document.addEventListener(event, (this.executeHandlersBottomUp));\r\n        }\r\n        this.eventTargets.get(event).add(target);\r\n        if (!this.targetHandlers.has(target)) {\r\n            this.targetHandlers.set(target, []);\r\n        }\r\n        this.targetHandlers.get(target).push({\r\n            event: event,\r\n            handler: handler,\r\n        });\r\n        return;\r\n    }\r\n    detachEventHandlers(event, target) {\r\n        this.eventTargets.get(event)?.delete(target);\r\n        this.targetHandlers.set(target, this.targetHandlers.get(target)?.filter((r) => r.event === event) ?? []);\r\n    }\r\n    // simulates event bubbling\r\n    executeHandlersBottomUp = (event) => {\r\n        if (!event.bubbles) {\r\n            throw new Error(\"delegated events should only be those that bubble\");\r\n        }\r\n        let curTarget = event.composedPath()[0];\r\n        let target = curTarget;\r\n        Object.defineProperty(event, \"target\", { get: () => target });\r\n        Object.defineProperty(event, \"currentTarget\", { get: () => curTarget });\r\n        // bubble bottom-up - we are traversing the ll manually due to the composedPath\r\n        // not always containing the complete list of nodes (specifically, closed shadow dom nodes)\r\n        while (notNullOrUndefined(curTarget) && !event.cancelBubble) {\r\n            if (this.eventTargets.get(event.type)?.has(curTarget) ?? false) {\r\n                this.targetHandlers.get(curTarget)?.forEach((h) => {\r\n                    h.event === event.type && h.handler(event);\r\n                });\r\n            }\r\n            // https://developer.mozilla.org/en-US/docs/Web/API/ShadowRoot/host\r\n            if (notNullOrUndefined(curTarget?.host) &&\r\n                curTarget.host instanceof Node) {\r\n                // https://developer.mozilla.org/en-US/docs/Web/API/Event/composed\r\n                curTarget = event.composed ? curTarget.host : null;\r\n                // since we have crossed a shadow dom boundary, we need to reset target to the shadow dom host node\r\n                target = curTarget;\r\n            }\r\n            else {\r\n                curTarget = curTarget.parentNode;\r\n            }\r\n        }\r\n        return;\r\n    };\r\n}\r\n//# sourceMappingURL=event.js.map","references":["/Users/eric.rodriguez/personal/dev/recoil/packages/dom/node_modules/shared/lib/index.ts"],"map":"{\"version\":3,\"file\":\"event.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../lib/event.ts\"],\"names\":[],\"mappings\":\"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\"}","dtsmap":{"name":"/Users/eric.rodriguez/personal/dev/recoil/packages/dom/node_modules/.cache/rollup-plugin-typescript2/placeholder/lib/event.d.ts.map","writeByteOrderMark":false,"text":"{\"version\":3,\"file\":\"event.d.ts\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../lib/event.ts\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAE,QAAQ,EAAsB,MAAM,QAAQ,CAAC;AAOtD,qBAAa,sBAAsB;IACjC,OAAO,CAAC,QAAQ,CAAC,YAAY,CAAgD;IAC7E,OAAO,CAAC,QAAQ,CAAC,cAAc,CACf;IAKT,kBAAkB,CAAC,CAAC,SAAS,MAAM,mBAAmB,EAC3D,KAAK,EAAE,CAAC,EACR,MAAM,EAAE,WAAW,EACnB,OAAO,EAAE,QAAQ,CAAC,mBAAmB,CAAC,CAAC,CAAC,CAAC,GACxC,IAAI;IAkBA,mBAAmB,CAAC,CAAC,SAAS,MAAM,mBAAmB,EAC5D,KAAK,EAAE,CAAC,EACR,MAAM,EAAE,WAAW,GAClB,IAAI;IASP,OAAO,CAAC,uBAAuB,CAqC7B;CACH\"}"},"dts":{"name":"/Users/eric.rodriguez/personal/dev/recoil/packages/dom/node_modules/.cache/rollup-plugin-typescript2/placeholder/lib/event.d.ts","writeByteOrderMark":false,"text":"import { Consumer } from \"shared\";\r\nexport declare class GlobalEventCoordinator {\r\n    private readonly eventTargets;\r\n    private readonly targetHandlers;\r\n    attachEventHandler<K extends keyof HTMLElementEventMap>(event: K, target: EventTarget, handler: Consumer<HTMLElementEventMap[K]>): void;\r\n    detachEventHandlers<K extends keyof HTMLElementEventMap>(event: K, target: EventTarget): void;\r\n    private executeHandlersBottomUp;\r\n}\r\n//# sourceMappingURL=event.d.ts.map"}}
