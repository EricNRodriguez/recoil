{"code":"import { reconcileNodeArrays } from \"./reconcile\";\r\nimport { notNullOrUndefined, nullOrUndefined } from \"shared\";\r\nexport class BaseWNode {\r\n    parent = null;\r\n    node;\r\n    isDocumentFragment;\r\n    children = [];\r\n    onMountHooks = new Set();\r\n    onUnmountHooks = new Set();\r\n    currentlyMounted = false;\r\n    constructor(node) {\r\n        this.node = node;\r\n        this.isDocumentFragment = this.node instanceof DocumentFragment;\r\n    }\r\n    isFragment() {\r\n        return this.isDocumentFragment;\r\n    }\r\n    setProperty(prop, value) {\r\n        this.unwrap()[prop] = value;\r\n        return this;\r\n    }\r\n    getUnpackedChildren() {\r\n        const unpackedNodes = [];\r\n        for (let wNode of this.getChildren()) {\r\n            if (wNode.isFragment()) {\r\n                for (let child of wNode.getUnpackedChildren()) {\r\n                    unpackedNodes.push(child);\r\n                }\r\n            }\r\n            else {\r\n                unpackedNodes.push(wNode.unwrap());\r\n            }\r\n        }\r\n        return unpackedNodes;\r\n    }\r\n    getChildren() {\r\n        return this.children;\r\n    }\r\n    rebindChildren() {\r\n        this.setChildren(this.children);\r\n    }\r\n    setChildren(children) {\r\n        const newChildren = children\r\n            .map(wrapInVNode)\r\n            .filter(notNullOrUndefined);\r\n        const newChildrenSet = new Set(newChildren);\r\n        // unmount any current children that are not in the newChildren list\r\n        if (this.isMounted()) {\r\n            this.children\r\n                .filter((cc) => !newChildrenSet.has(cc))\r\n                .forEach((cc) => {\r\n                cc.unmount();\r\n                cc.setParent(null);\r\n            });\r\n        }\r\n        this.children.length = 0;\r\n        this.children.push(...newChildren);\r\n        // sync mount status of new children to this dom node\r\n        newChildren.forEach((nc) => {\r\n            nc.setParent(this);\r\n            this.syncMountStatusOfChild(nc);\r\n        });\r\n        if (this.isFragment()) {\r\n            this.getParent()?.rebindChildren();\r\n            return this;\r\n        }\r\n        reconcileNodeArrays({\r\n            parent: this.unwrap(),\r\n            currentNodes: Array.from(this.unwrap().childNodes),\r\n            newNodes: this.getUnpackedChildren(),\r\n        });\r\n        return this;\r\n    }\r\n    syncMountStatusOfChild(child) {\r\n        child.setParent(this);\r\n        if (this.isMounted() !== child.isMounted()) {\r\n            this.isMounted() ? child.mount() : child.unmount();\r\n        }\r\n    }\r\n    isMounted() {\r\n        return this.currentlyMounted;\r\n    }\r\n    setParent(parent) {\r\n        this.parent = parent;\r\n    }\r\n    getParent() {\r\n        return this.parent;\r\n    }\r\n    mount() {\r\n        this.currentlyMounted = true;\r\n        this.children.forEach((child) => {\r\n            child.mount();\r\n        });\r\n        this.runMountHooks();\r\n        return this;\r\n    }\r\n    unmount() {\r\n        this.currentlyMounted = false;\r\n        this.children.forEach((child) => {\r\n            child.unmount();\r\n        });\r\n        this.runUnmountHooks();\r\n        return this;\r\n    }\r\n    runUnmountHooks() {\r\n        this.onUnmountHooks.forEach((hook) => hook());\r\n    }\r\n    runMountHooks() {\r\n        this.onMountHooks.forEach((hook) => hook());\r\n    }\r\n    registerOnMountHook(hook) {\r\n        this.onMountHooks.add(hook);\r\n        return this;\r\n    }\r\n    registerOnUnmountHook(hook) {\r\n        this.onUnmountHooks.add(hook);\r\n        return this;\r\n    }\r\n    unwrap() {\r\n        return this.node;\r\n    }\r\n}\r\nexport class WNode extends BaseWNode {\r\n    constructor(node) {\r\n        super(node);\r\n    }\r\n}\r\nexport const isWNode = (content) => {\r\n    return content instanceof Object && \"unwrap\" in content;\r\n};\r\nexport const unwrapVNode = (content) => {\r\n    if (content === null || content === undefined) {\r\n        return content;\r\n    }\r\n    if (isWNode(content)) {\r\n        return content.unwrap();\r\n    }\r\n    return content;\r\n};\r\nexport const wrapInVNode = (node) => {\r\n    if (nullOrUndefined(node)) {\r\n        return node;\r\n    }\r\n    if (isWNode(node)) {\r\n        return node;\r\n    }\r\n    else {\r\n        return new WNode(node);\r\n    }\r\n};\r\n//# sourceMappingURL=node.js.map","references":["/Users/eric.rodriguez/personal/dev/recoil/packages/dom/lib/reconcile.ts","/Users/eric.rodriguez/personal/dev/recoil/packages/shared/lib/index.ts","/Users/eric.rodriguez/personal/dev/recoil/packages/shared/lib/index.ts"],"map":"{\"version\":3,\"file\":\"node.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../dom/lib/node.ts\"],\"names\":[],\"mappings\":\"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\"}","dtsmap":{"name":"/Users/eric.rodriguez/personal/dev/recoil/packages/dom-jsx/node_modules/.cache/rollup-plugin-typescript2/placeholder/dom/lib/node.d.ts.map","writeByteOrderMark":false,"text":"{\"version\":3,\"file\":\"node.d.ts\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../dom/lib/node.ts\"],\"names\":[],\"mappings\":\"AACA,OAAO,EAAE,QAAQ,EAAE,MAAM,QAAQ,CAAC;AAGlC,8BAAsB,SAAS,CAAC,CAAC,SAAS,IAAI,EAAE,CAAC,SAAS,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC;IACvE,OAAO,CAAC,MAAM,CAA4B;IAC1C,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAI;IACzB,OAAO,CAAC,QAAQ,CAAC,kBAAkB,CAAU;IAC7C,OAAO,CAAC,QAAQ,CAAC,QAAQ,CAAqB;IAC9C,OAAO,CAAC,QAAQ,CAAC,YAAY,CAAsC;IACnE,OAAO,CAAC,QAAQ,CAAC,cAAc,CAAsC;IACrE,OAAO,CAAC,gBAAgB,CAAkB;IAE1C,SAAS,aAAa,IAAI,EAAE,CAAC;IAK7B,OAAO,CAAC,UAAU;IAIX,WAAW,CAAC,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,GAAG,CAAC;IAKhD,OAAO,CAAC,mBAAmB;IAgBpB,WAAW,IAAI,KAAK,CAAC,IAAI,CAAC,EAAE;IAInC,OAAO,CAAC,cAAc;IAIf,WAAW,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,IAAI,GAAG,IAAI,GAAG,SAAS,CAAC,EAAE,GAAG,CAAC;IAsCnE,sBAAsB,CAAC,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,GAAG,IAAI;IAOhD,SAAS,IAAI,OAAO;IAI3B,OAAO,CAAC,SAAS;IAIV,SAAS,IAAI,KAAK,CAAC,IAAI,CAAC,GAAG,IAAI;IAI/B,KAAK,IAAI,CAAC;IASV,OAAO,IAAI,CAAC;IASnB,OAAO,CAAC,eAAe;IAIvB,OAAO,CAAC,aAAa;IAId,mBAAmB,CAAC,IAAI,EAAE,QAAQ,GAAG,CAAC;IAMtC,qBAAqB,CAAC,IAAI,EAAE,QAAQ,GAAG,CAAC;IAMxC,MAAM,IAAI,CAAC;CAGnB;AAED,qBAAa,KAAK,CAAC,CAAC,SAAS,IAAI,CAAE,SAAQ,SAAS,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;gBACnD,IAAI,EAAE,CAAC;CAGpB;AAED,eAAO,MAAM,OAAO,YAAa,GAAG,KAAG,OAEtC,CAAC;AAEF,eAAO,MAAM,WAAW,YAAa,IAAI,GAAG,MAAM,IAAI,CAAC,KAAG,IAUzD,CAAC;AAEF,eAAO,MAAM,WAAW,SAChB,MAAM,IAAI,CAAC,GAAG,IAAI,GAAG,MAAM,GAAG,IAAI,GAAG,SAAS,KACnD,MAAM,IAAI,CAAC,GAAG,IAAI,GAAG,SAUvB,CAAC\"}"},"dts":{"name":"/Users/eric.rodriguez/personal/dev/recoil/packages/dom-jsx/node_modules/.cache/rollup-plugin-typescript2/placeholder/dom/lib/node.d.ts","writeByteOrderMark":false,"text":"import { Runnable } from \"shared\";\r\nexport declare abstract class BaseWNode<A extends Node, B extends BaseWNode<A, B>> {\r\n    private parent;\r\n    private readonly node;\r\n    private readonly isDocumentFragment;\r\n    private readonly children;\r\n    private readonly onMountHooks;\r\n    private readonly onUnmountHooks;\r\n    private currentlyMounted;\r\n    protected constructor(node: A);\r\n    private isFragment;\r\n    setProperty<T>(prop: string, value: T): B;\r\n    private getUnpackedChildren;\r\n    getChildren(): WNode<Node>[];\r\n    private rebindChildren;\r\n    setChildren(children: (WNode<Node> | Node | null | undefined)[]): B;\r\n    syncMountStatusOfChild(child: WNode<Node>): void;\r\n    isMounted(): boolean;\r\n    private setParent;\r\n    getParent(): WNode<Node> | null;\r\n    mount(): B;\r\n    unmount(): B;\r\n    private runUnmountHooks;\r\n    private runMountHooks;\r\n    registerOnMountHook(hook: Runnable): B;\r\n    registerOnUnmountHook(hook: Runnable): B;\r\n    unwrap(): A;\r\n}\r\nexport declare class WNode<T extends Node> extends BaseWNode<T, WNode<T>> {\r\n    constructor(node: T);\r\n}\r\nexport declare const isWNode: (content: any) => boolean;\r\nexport declare const unwrapVNode: (content: Node | WNode<Node>) => Node;\r\nexport declare const wrapInVNode: (node: WNode<Node> | Node | string | null | undefined) => WNode<Node> | null | undefined;\r\n//# sourceMappingURL=node.d.ts.map"}}
