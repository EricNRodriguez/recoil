{"code":"export class WeakCollection {\r\n    items = [];\r\n    itemsSet = new WeakSet([]);\r\n    getItems() {\r\n        const items = [\r\n            ...this.items\r\n                .map((ref) => ref.deref())\r\n                .filter((item) => item !== undefined)\r\n                .map((item) => item),\r\n        ];\r\n        this.removeGCdItems();\r\n        return items;\r\n    }\r\n    register(item) {\r\n        if (this.itemsSet.has(item)) {\r\n            return;\r\n        }\r\n        const ref = new WeakRef(item);\r\n        this.itemsSet.add(item);\r\n        this.items.push(ref);\r\n    }\r\n    deregister(item) {\r\n        this.itemsSet.delete(item);\r\n        this.items = this.items.filter((v) => v.deref() !== item);\r\n    }\r\n    reset() {\r\n        this.items.forEach((ref) => {\r\n            const item = ref.deref();\r\n            if (item !== undefined) {\r\n                this.itemsSet.delete(item);\r\n            }\r\n        });\r\n        this.items = [];\r\n    }\r\n    forEach(consumer) {\r\n        this.items.forEach((ref) => {\r\n            const item = ref.deref();\r\n            if (item !== undefined) {\r\n                consumer(item);\r\n            }\r\n        });\r\n        this.removeGCdItems();\r\n    }\r\n    removeGCdItems() {\r\n        this.items = this.items.filter((ref) => ref.deref() !== undefined);\r\n    }\r\n}\r\n//# sourceMappingURL=weak_collection.js.map","references":["/Users/eric.rodriguez/personal/dev/recoil/packages/shared/lib/index.ts"],"map":"{\"version\":3,\"file\":\"weak_collection.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../atom/lib/weak_collection.ts\"],\"names\":[],\"mappings\":\"AAEA,MAAM,OAAO,cAAc;IACjB,KAAK,GAAiB,EAAE,CAAC;IACzB,QAAQ,GAAe,IAAI,OAAO,CAAC,EAAE,CAAC,CAAC;IAExC,QAAQ;QACb,MAAM,KAAK,GAAG;YACZ,GAAG,IAAI,CAAC,KAAK;iBACV,GAAG,CAAC,CAAC,GAAe,EAAiB,EAAE,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC;iBACpD,MAAM,CAAC,CAAC,IAAmB,EAAW,EAAE,CAAC,IAAI,KAAK,SAAS,CAAC;iBAC5D,GAAG,CAAC,CAAC,IAAmB,EAAK,EAAE,CAAC,IAAK,CAAC;SAC1C,CAAC;QACF,IAAI,CAAC,cAAc,EAAE,CAAC;QACtB,OAAO,KAAK,CAAC;IACf,CAAC;IAEM,QAAQ,CAAC,IAAO;QACrB,IAAI,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE;YAC3B,OAAO;SACR;QAED,MAAM,GAAG,GAAe,IAAI,OAAO,CAAI,IAAI,CAAC,CAAC;QAC7C,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QACxB,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IACvB,CAAC;IAEM,UAAU,CAAC,IAAO;QACvB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QAC3B,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,KAAK,EAAE,KAAK,IAAI,CAAC,CAAC;IAC5D,CAAC;IAEM,KAAK;QACV,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,GAAe,EAAQ,EAAE;YAC3C,MAAM,IAAI,GAAkB,GAAG,CAAC,KAAK,EAAE,CAAC;YACxC,IAAI,IAAI,KAAK,SAAS,EAAE;gBACtB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;aAC5B;QACH,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC;IAClB,CAAC;IAEM,OAAO,CAAC,QAAqB;QAClC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,GAAe,EAAQ,EAAE;YAC3C,MAAM,IAAI,GAAkB,GAAG,CAAC,KAAK,EAAE,CAAC;YACxC,IAAI,IAAI,KAAK,SAAS,EAAE;gBACtB,QAAQ,CAAC,IAAI,CAAC,CAAC;aAChB;QACH,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,cAAc,EAAE,CAAC;IACxB,CAAC;IAEO,cAAc;QACpB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAC5B,CAAC,GAAe,EAAE,EAAE,CAAC,GAAG,CAAC,KAAK,EAAE,KAAK,SAAS,CAC/C,CAAC;IACJ,CAAC;CACF\"}","dtsmap":{"name":"/Users/eric.rodriguez/personal/dev/recoil/packages/dom-jsx/node_modules/.cache/rollup-plugin-typescript2/placeholder/atom/lib/weak_collection.d.ts.map","writeByteOrderMark":false,"text":"{\"version\":3,\"file\":\"weak_collection.d.ts\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../atom/lib/weak_collection.ts\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAE,QAAQ,EAAE,MAAM,QAAQ,CAAC;AAElC,qBAAa,cAAc,CAAC,CAAC,SAAS,MAAM;IAC1C,OAAO,CAAC,KAAK,CAAoB;IACjC,OAAO,CAAC,QAAQ,CAA+B;IAExC,QAAQ,IAAI,CAAC,EAAE;IAWf,QAAQ,CAAC,IAAI,EAAE,CAAC,GAAG,IAAI;IAUvB,UAAU,CAAC,IAAI,EAAE,CAAC,GAAG,IAAI;IAKzB,KAAK;IAUL,OAAO,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC,CAAC,GAAG,IAAI;IAU3C,OAAO,CAAC,cAAc;CAKvB\"}"},"dts":{"name":"/Users/eric.rodriguez/personal/dev/recoil/packages/dom-jsx/node_modules/.cache/rollup-plugin-typescript2/placeholder/atom/lib/weak_collection.d.ts","writeByteOrderMark":false,"text":"import { Consumer } from \"shared\";\r\nexport declare class WeakCollection<T extends Object> {\r\n    private items;\r\n    private itemsSet;\r\n    getItems(): T[];\r\n    register(item: T): void;\r\n    deregister(item: T): void;\r\n    reset(): void;\r\n    forEach(consumer: Consumer<T>): void;\r\n    private removeGCdItems;\r\n}\r\n//# sourceMappingURL=weak_collection.d.ts.map"}}
