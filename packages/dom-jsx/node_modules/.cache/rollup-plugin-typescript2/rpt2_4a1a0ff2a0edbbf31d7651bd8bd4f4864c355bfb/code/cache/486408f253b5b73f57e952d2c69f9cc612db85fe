{"code":"import { notNullOrUndefined } from \"./type_check\";\r\nexport class WDerivationCache {\r\n    cache = new Map();\r\n    deriveValue;\r\n    constructor(deriveValue) {\r\n        this.deriveValue = deriveValue;\r\n    }\r\n    get(key) {\r\n        this.gc();\r\n        const val = this.cache.get(key)?.deref();\r\n        if (notNullOrUndefined(val)) {\r\n            return val;\r\n        }\r\n        const newVal = this.deriveValue(key);\r\n        this.cache.set(key, new WeakRef(newVal));\r\n        return newVal;\r\n    }\r\n    gc() {\r\n        for (let key of this.cache.keys()) {\r\n            const valRef = this.cache.get(key);\r\n            if (valRef.deref() === undefined) {\r\n                this.cache.delete(key);\r\n            }\r\n        }\r\n    }\r\n}\r\n//# sourceMappingURL=weak_cache.js.map","references":["/Users/eric.rodriguez/personal/dev/recoil/packages/shared/lib/function.interface.ts","/Users/eric.rodriguez/personal/dev/recoil/packages/shared/lib/type_check.ts"],"map":"{\"version\":3,\"file\":\"weak_cache.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../shared/lib/weak_cache.ts\"],\"names\":[],\"mappings\":\"AACA,OAAO,EAAE,kBAAkB,EAAE,MAAM,cAAc,CAAC;AAElD,MAAM,OAAO,gBAAgB;IACV,KAAK,GAAuB,IAAI,GAAG,EAAE,CAAC;IACtC,WAAW,CAAiB;IAE7C,YAAY,WAA2B;QACrC,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;IACjC,CAAC;IAEM,GAAG,CAAC,GAAM;QACf,IAAI,CAAC,EAAE,EAAE,CAAC;QAEV,MAAM,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,KAAK,EAAE,CAAC;QACzC,IAAI,kBAAkB,CAAC,GAAG,CAAC,EAAE;YAC3B,OAAO,GAAI,CAAC;SACb;QAED,MAAM,MAAM,GAAM,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;QACxC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,EAAE,IAAI,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC;QACzC,OAAO,MAAM,CAAC;IAChB,CAAC;IAEO,EAAE;QACR,KAAK,IAAI,GAAG,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,EAAE;YACjC,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,CAAE,CAAC;YACpC,IAAI,MAAM,CAAC,KAAK,EAAE,KAAK,SAAS,EAAE;gBAChC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;aACxB;SACF;IACH,CAAC;CACF\"}","dtsmap":{"name":"/Users/eric.rodriguez/personal/dev/recoil/packages/dom-jsx/node_modules/.cache/rollup-plugin-typescript2/placeholder/shared/lib/weak_cache.d.ts.map","writeByteOrderMark":false,"text":"{\"version\":3,\"file\":\"weak_cache.d.ts\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../shared/lib/weak_cache.ts\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAE,QAAQ,EAAE,MAAM,sBAAsB,CAAC;AAGhD,qBAAa,gBAAgB,CAAC,CAAC,EAAE,CAAC,SAAS,MAAM;IAC/C,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAiC;IACvD,OAAO,CAAC,QAAQ,CAAC,WAAW,CAAiB;gBAEjC,WAAW,EAAE,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC;IAIhC,GAAG,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC;IAarB,OAAO,CAAC,EAAE;CAQX\"}"},"dts":{"name":"/Users/eric.rodriguez/personal/dev/recoil/packages/dom-jsx/node_modules/.cache/rollup-plugin-typescript2/placeholder/shared/lib/weak_cache.d.ts","writeByteOrderMark":false,"text":"import { Function } from \"./function.interface\";\r\nexport declare class WDerivationCache<K, V extends Object> {\r\n    private readonly cache;\r\n    private readonly deriveValue;\r\n    constructor(deriveValue: Function<K, V>);\r\n    get(key: K): V;\r\n    private gc;\r\n}\r\n//# sourceMappingURL=weak_cache.d.ts.map"}}
