{"code":"import { Maybe } from \"typescript-monads\";\r\nimport { StatefulSideEffectError } from \"./error\";\r\nimport { WeakCollection } from \"./weak_collection\";\r\nexport const isAtom = (obj) => {\r\n    return (obj instanceof Object &&\r\n        \"get\" in obj &&\r\n        \"getUntracked\" in obj &&\r\n        \"invalidate\" in obj &&\r\n        \"map\" in obj);\r\n};\r\nclass BaseAtom {\r\n    context;\r\n    parents = new WeakCollection();\r\n    constructor(context) {\r\n        this.context = context;\r\n    }\r\n    getParents() {\r\n        return this.parents.getItems();\r\n    }\r\n    forgetParents() {\r\n        this.parents.reset();\r\n    }\r\n    invalidate() {\r\n        this.parents.forEach((parent) => {\r\n            parent.childDirty();\r\n            parent.childReady();\r\n        });\r\n    }\r\n    getContext() {\r\n        return this.context;\r\n    }\r\n    latchToCurrentDerivation() {\r\n        this.getContext()\r\n            .getCurrentParent()\r\n            .tapSome(this.parents.register.bind(this.parents));\r\n    }\r\n    map(mutation) {\r\n        return new VirtualDerivedAtom(this.context, () => mutation(this.get()));\r\n    }\r\n}\r\nexport class MutableAtom extends BaseAtom {\r\n    value;\r\n    constructor(value, context) {\r\n        super(context);\r\n        this.value = value;\r\n    }\r\n    get() {\r\n        this.latchToCurrentDerivation();\r\n        return this.getUntracked();\r\n    }\r\n    getUntracked() {\r\n        return this.value;\r\n    }\r\n    set(value) {\r\n        this.checkSetIsNotASideEffect();\r\n        if (value === this.value) {\r\n            return;\r\n        }\r\n        this.value = value;\r\n        // intentionally kicking AFTER setting, since\r\n        // we want our effects to run with the new values\r\n        this.dirty();\r\n    }\r\n    update(fn) {\r\n        this.set(fn(this.getUntracked()));\r\n    }\r\n    dirty() {\r\n        const prevParents = this.getParents();\r\n        this.forgetParents();\r\n        prevParents.forEach((parent) => {\r\n            parent.childDirty();\r\n            parent.childReady();\r\n        });\r\n    }\r\n    checkSetIsNotASideEffect() {\r\n        if (this.getContext().getCurrentParent().isSome()) {\r\n            throw new StatefulSideEffectError(\"stateful set called on leaf atom during derivation\");\r\n        }\r\n    }\r\n}\r\n/**\r\n * A derivation that is logically a node in the DAG, but is actually just a virtual node - the runtime graph\r\n * has no knowledge of it.\r\n */\r\nexport class VirtualDerivedAtom {\r\n    context;\r\n    derivation;\r\n    tracker;\r\n    constructor(context, derivation) {\r\n        this.context = context;\r\n        this.derivation = derivation;\r\n        this.tracker = new MutableAtom(false, context);\r\n    }\r\n    get() {\r\n        this.tracker.get();\r\n        return this.derivation();\r\n    }\r\n    getUntracked() {\r\n        this.context.enterNewTrackingContext();\r\n        try {\r\n            return this.get();\r\n        }\r\n        finally {\r\n            this.context.exitCurrentTrackingContext();\r\n        }\r\n    }\r\n    invalidate() {\r\n        this.tracker.invalidate();\r\n    }\r\n    map(transform) {\r\n        return new VirtualDerivedAtom(this.context, () => transform(this.get()));\r\n    }\r\n}\r\nexport class DerivedAtom extends BaseAtom {\r\n    deriveValue;\r\n    value = Maybe.none();\r\n    numChildrenNotReady = 0;\r\n    constructor(deriveValue, context) {\r\n        super(context);\r\n        this.deriveValue = deriveValue;\r\n    }\r\n    get() {\r\n        this.latchToCurrentDerivation();\r\n        return this.executeScopedDerivation();\r\n    }\r\n    executeScopedDerivation() {\r\n        try {\r\n            this.getContext().pushParent(this);\r\n            return this.getValue();\r\n        }\r\n        finally {\r\n            this.getContext().popParent();\r\n        }\r\n    }\r\n    getUntracked() {\r\n        this.getContext().enterNewTrackingContext();\r\n        try {\r\n            return this.executeScopedDerivation();\r\n        }\r\n        finally {\r\n            this.getContext().exitCurrentTrackingContext();\r\n        }\r\n    }\r\n    getValue() {\r\n        if (this.value.isNone()) {\r\n            this.value = Maybe.some(this.deriveValue());\r\n        }\r\n        return this.value.valueOrThrow();\r\n    }\r\n    childReady() {\r\n        this.numChildrenNotReady--;\r\n        if (this.numChildrenNotReady === 0) {\r\n            const prevParents = this.getParents();\r\n            this.forgetParents();\r\n            prevParents.forEach((parent) => {\r\n                parent.childReady();\r\n            });\r\n        }\r\n    }\r\n    childDirty() {\r\n        this.discardCachedValue();\r\n        if (this.numChildrenNotReady === 0) {\r\n            this.getParents().forEach((parent) => {\r\n                parent.childDirty();\r\n            });\r\n        }\r\n        this.numChildrenNotReady++;\r\n    }\r\n    discardCachedValue() {\r\n        this.value = Maybe.none();\r\n    }\r\n}\r\nvar SideEffectStatus;\r\n(function (SideEffectStatus) {\r\n    SideEffectStatus[\"ACTIVE\"] = \"active\";\r\n    SideEffectStatus[\"INACTIVE\"] = \"inactive\";\r\n})(SideEffectStatus || (SideEffectStatus = {}));\r\nexport class SideEffect {\r\n    effect;\r\n    effectScheduler;\r\n    context;\r\n    numChildrenNotReady = 0;\r\n    state = { status: SideEffectStatus.ACTIVE };\r\n    constructor(effect, context, effectScheduler) {\r\n        this.effect = effect;\r\n        this.context = context;\r\n        this.effectScheduler = effectScheduler;\r\n    }\r\n    run() {\r\n        this.effectScheduler.schedule(this.runScoped);\r\n    }\r\n    runScoped = () => {\r\n        try {\r\n            this.context.pushParent(this);\r\n            this.effect();\r\n        }\r\n        finally {\r\n            this.context.popParent();\r\n        }\r\n    };\r\n    childReady() {\r\n        this.numChildrenNotReady--;\r\n        if (this.numChildrenNotReady === 0) {\r\n            switch (this.state.status) {\r\n                case SideEffectStatus.ACTIVE:\r\n                    this.run();\r\n                    return;\r\n                case SideEffectStatus.INACTIVE:\r\n                    this.state.dirty = true;\r\n                    return;\r\n                default:\r\n                    throw new Error(\"invalid state\");\r\n            }\r\n        }\r\n    }\r\n    childDirty() {\r\n        this.numChildrenNotReady++;\r\n    }\r\n    activate() {\r\n        if (this.state.status === SideEffectStatus.ACTIVE) {\r\n            return;\r\n        }\r\n        if (this.state.dirty) {\r\n            this.run();\r\n        }\r\n        this.state = { status: SideEffectStatus.ACTIVE };\r\n    }\r\n    deactivate() {\r\n        this.state = { status: SideEffectStatus.INACTIVE, dirty: false };\r\n    }\r\n}\r\n//# sourceMappingURL=atom.js.map","references":["/Users/eric.rodriguez/personal/dev/recoil/node_modules/typescript-monads/index.d.ts","/Users/eric.rodriguez/personal/dev/recoil/packages/atom/lib/atom.interface.ts","/Users/eric.rodriguez/personal/dev/recoil/packages/atom/lib/context.ts","/Users/eric.rodriguez/personal/dev/recoil/packages/atom/lib/error.ts","/Users/eric.rodriguez/personal/dev/recoil/packages/atom/lib/weak_collection.ts","/Users/eric.rodriguez/personal/dev/recoil/node_modules/shared/lib/index.ts"],"map":"{\"version\":3,\"file\":\"atom.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../../atom/lib/atom.ts\"],\"names\":[],\"mappings\":\"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\"}","dtsmap":{"name":"/Users/eric.rodriguez/personal/dev/recoil/packages/context/node_modules/.cache/rollup-plugin-typescript2/placeholder/packages/atom/lib/atom.d.ts.map","writeByteOrderMark":false,"text":"{\"version\":3,\"file\":\"atom.d.ts\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../../atom/lib/atom.ts\"],\"names\":[],\"mappings\":\"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\"}"},"dts":{"name":"/Users/eric.rodriguez/personal/dev/recoil/packages/context/node_modules/.cache/rollup-plugin-typescript2/placeholder/packages/atom/lib/atom.d.ts","writeByteOrderMark":false,"text":"import { IAtom, IMutableAtom } from \"./atom.interface\";\r\nimport { AtomTrackingContext, ParentAtom } from \"./context\";\r\nimport { Producer, Runnable, Function, Supplier } from \"shared\";\r\nexport declare const isAtom: (obj: any) => boolean;\r\ndeclare abstract class BaseAtom<T> implements IAtom<T> {\r\n    private readonly context;\r\n    private readonly parents;\r\n    protected constructor(context: AtomTrackingContext);\r\n    abstract get(): T;\r\n    abstract getUntracked(): T;\r\n    protected getParents(): ParentAtom[];\r\n    protected forgetParents(): void;\r\n    invalidate(): void;\r\n    protected getContext(): AtomTrackingContext;\r\n    latchToCurrentDerivation(): void;\r\n    map<R>(mutation: Function<T, R>): IAtom<R>;\r\n}\r\nexport interface IEffectScheduler {\r\n    schedule(effect: Runnable): void;\r\n}\r\nexport declare class MutableAtom<T> extends BaseAtom<T> implements IMutableAtom<T> {\r\n    private value;\r\n    constructor(value: T, context: AtomTrackingContext);\r\n    get(): T;\r\n    getUntracked(): T;\r\n    set(value: T): void;\r\n    update(fn: (val: T) => T): void;\r\n    dirty(): void;\r\n    private checkSetIsNotASideEffect;\r\n}\r\n/**\r\n * A derivation that is logically a node in the DAG, but is actually just a virtual node - the runtime graph\r\n * has no knowledge of it.\r\n */\r\nexport declare class VirtualDerivedAtom<T> implements IAtom<T> {\r\n    private readonly context;\r\n    private readonly derivation;\r\n    private readonly tracker;\r\n    constructor(context: AtomTrackingContext, derivation: Supplier<T>);\r\n    get(): T;\r\n    getUntracked(): T;\r\n    invalidate(): void;\r\n    map<R>(transform: Function<T, R>): IAtom<R>;\r\n}\r\nexport declare class DerivedAtom<T> extends BaseAtom<T> {\r\n    private readonly deriveValue;\r\n    private value;\r\n    private numChildrenNotReady;\r\n    constructor(deriveValue: Producer<T>, context: AtomTrackingContext);\r\n    get(): T;\r\n    private executeScopedDerivation;\r\n    getUntracked(): T;\r\n    private getValue;\r\n    childReady(): void;\r\n    childDirty(): void;\r\n    private discardCachedValue;\r\n}\r\nexport declare class SideEffect {\r\n    private readonly effect;\r\n    private readonly effectScheduler;\r\n    private readonly context;\r\n    private numChildrenNotReady;\r\n    private state;\r\n    constructor(effect: Runnable, context: AtomTrackingContext, effectScheduler: IEffectScheduler);\r\n    run(): void;\r\n    private runScoped;\r\n    childReady(): void;\r\n    childDirty(): void;\r\n    activate(): void;\r\n    deactivate(): void;\r\n}\r\nexport {};\r\n//# sourceMappingURL=atom.d.ts.map"}}
